# 神秘巫师Haskell

## chapter 0： Haskell的诞生

与其他的编程语言相比，Haskell给它的初学者的感觉更像是一位巫师，神秘、晦涩而且难以捉摸。任何对Haskell感兴趣的人，都应该对Haskell有一个基本认识。比如Haskell之所以特别其实是因为与C语言、Java这些命令式编程语言相比，Haskell是一门纯粹的函数式程序语言。

那么什么是函数式编程语言，它与命令式编程语言又有哪些区别呢？简单来说，命令式语言就是一种描述电脑所需作出行为的编程典范，让机器按照规定的命令执行下去。函数式编程又被称为泛函编程，它将电脑运算视为数学上的函数计算，并避免使用程序状态以及易变对象。

虽然命令式编程语言更加普遍，但其实函数式编程也有自己的优点。比如，在函数式编程中减少了变量的声明，这让程序更为安全。而且相比命令式编程，函数式编程少了非常多的状态变量的声明与维护，天然适合高并发多线程并行计算等任务，这也是函数是编程近年又大热的一个重要原因。

在80年代末已经出现了一些函数式编程语言,它们各有自己的长处。但是这些语言多而不精，反而拖慢了函数式编程语言发展的步伐。

1987年9月，在俄勒冈州波特兰举行的函数式编程语言和计算机体系结构会议上，人们讨论了函数式编程社区中的一种不幸情况：已经出现了十几种非严格的、纯函数式编程语言，它们在表达能力和语义基础上都十分相似。其中，Miranda使用的最为广泛，但还没有出现在公共领域。 在本次会议上，人们对由于缺乏通用语言，阻碍了此类函数语言的更广泛使用这一意见都表示了赞同，也因此决定成立一个委员会来统一这种语言，以提供更快的新思想交流，为实际应用程序开发提供稳定的基础，并鼓励其他人使用函数性语言[1]。

在这样的背景下，Haskell诞生了。1990年，人们在编程语言Miranda的基础上标准化(而Miranda的开发者却对此项工作并不感兴趣)，并且以Lambda-Calculi(λ演算)为基础设计出了Haskell语言。这一发行的Haskell版本也被称为“Haskell 1.0”。

从这一刻起，Haskell终于正式登上了编程语言的大舞台！

## chapter 1： Haskell的介绍

相信很多学习Haskell的人都看到过这样一句话：“证明即程序、结论公式即程序类型“

这句看起来十分拗口又十分具有数学气质的话其实是Haskell语言的典型特征。纯函数式的编程语言虽然有时让人难以理解，但往往也会给习惯了命令式编程语言的学生一个新的思路。与此同时，它也很适合作为初学者接触编程的第一门语言，体现出编程世界的多样性以及有趣性，这也是为什么部分国外的大学第一年都以haskell为新生入门课程。关于这里还有一个小故事，我们会在接下来的章节中介绍。

Haskell是一门惰性语言，顾名思义，当你在使用Haskell时，除非特殊指定声明，否则函数在真正需要结果之前不会被求值。

同时Haskell也是纯函数式语言，这带来的好处就是引用透明和无副作用。

引用透明是指：无论何时调用一个函数，对于相同的输入总产生相同的输出。

无副作用的意思是：不存在函数在执行过程中偷偷修改了一个全局状态而从函数类型签名上看不出来的情况。

当然，不是说Haskell里无法表达副作用，而是说Haskell通过 Monad（中文译为: 单子）这种手法，把副作用体现在类型签名上。在面向对象编程中，我们貌似更关注于“数据及它们的行为”：我们把程序表现为 一堆数据（对象objects），并通过使用对象提供的接口来访问这些数据。但在函数式编程中，我们的关注点更着眼于“数据及它们的流动处理”： 就像数学函数的连续运算一样。而Haskell有了'pure'的特点以后，就更有利于进行函数的“组合(composition)” 了： 因为函数都是“引用透明的”，所以真正发生计算的顺序就不重要了，这使得我们进行函数组合时更加得心应手。

使用Haskell编程总时不时有这种感觉：函数就像“水管”，而数据就像水管中的“水”，而我们所做的就是把不同的水管“首尾拼接起来”（其中每一段水管只完成特定的小工作）， 从而完成对数据的复杂的处理。

比如当我们需要写一个函数，将制定的数组中的数字全部乘以2，然后统计其中大于100的数字的个数时，使用Haskell只需要对 arr 进行 map (* 2)  ——> 再 filter (> 100) ——> 最后统计length个数 ， 一行代码即可，十分简洁与高效[2]。

当然了，我们都必须承认越简洁的代码越需要复杂的思考过程。纯粹的数学函数式思维让Haskell编程对于许多人来说并不友好。但也正是Haskell的与众不同才使得它充满了魅力。它迫使你用完全不同的方式思考你的程序。这是它成为一种很难学的语言的原因，但同样也是为什么学习它能获得这么多益处的原因。深奥的东西需要花时间去学。这很正常。这意味着你在学一些值得学的知识。

就像鼠标的发明者Douglas Englebart曾说过的这句话一样：

**“Do you want to be locked into tricycles because they’re easy to learn?”**



## chapter 2： Haskell的版本迭代
### Haskell 1.0 to 1.4
支持类型安全操作符重载的类型类，最早是由Philip Wadler和Stephen Blott为标准ML提出的，但在1987年Haskell的1.0版中首次实现。  
1990年定义了Haskell的第一个版本（“Haskell 1.0”）。委员会的努力促使产生了一个系列的语言定义（1.0，1.1,1.2,1.3,1.4）。
### Haskell 98  
在1997年后期，该系列以Haskell 98到达顶峰，旨在为教学指定一个稳定的、最小的、可移植的语言版本和一个附带的标准库，并作为将来扩展的基础。  
在1999年2月，Haskell 98语言标准最初以Haskell 98报告的形式发布。2003年1月，修订版以*Haskell 98语言与库：修订版报告*的形式出版。  
Haskell语言继续快速发展，同时Glasgow Haskell编译器(GHC)实现代表了当前*事实上的标准*[7]。
### Haskell Prime
2006年早期，开始了定义Haskell 98标准后续的进程，非正式命名为Haskell Prime。这是个修订语言定义的不断增补的过程，每年产生一个新的修订版。第一个修订版于2009年11月完成、2010年7月发布，称作Haskell 2010。
### Haskell 2010
Haskell 2010加入了外部函数接口（Foreign Function Interface，FFI）允许绑定到其它编程语言，修正了一些语法问题（在正式语法中的改动）并废除了称为“n加k模式”（换言之，不再允许形如fact (n+1) = (n+1) * fact n的定义）。引入了语言级编译选项语法扩展（Language-Pragma-Syntax-Extension），使得在Haskell源代码中可以明确要求一些扩展功能[8]。

## chapter 3： Haskell的编译环境

Haskell是一个公开的语言定义，所以任何人都可以编写它的实现（implement），所以Haskell的实现版本很多，甚至使得Haskell少见地具有编译与解释两种执行方式，这也被认为是Haskell的一大优点。Haskell有很多编译器与编译器，它们都可以在 www.haskell.org 上得到。解释器的优点是直观，程序编写好之后可以直接运行，便于学习与开发；编译器则可以将程序编译为可以独立执行的文件。[4]

目前，比较主流的Haskell实现是GHC。下面主要对GHC进行介绍。

GHC（Glasgow Haskell Compiler）是当前最先进的Haskell编译与交互环境，包括一个编译器ghc与类似python交互环境的解释器ghci。这一特点给使用者带来了极大的方便，想象一下你在编译之前可以直接通过解释执行的方式来进行调试，是不是十分诱人。GHC主要具有以下特点：
+ GHC支持全部的Haskell 2010语法，并且加入了很多扩展。
+ GHC可以在多个平台上运行，包括Windows、Mac、Linux以及大多数Unix，甚至还包括一些非x86的处理器架构
+ 具有代码优化功能。
+ GHC具有两种编译Haskell代码的方式。其一是直接将Haskell代码转化为机器代码，其二是使用LLVM作为编译的后端。GHC也可以生成C语言的中间代码，从而带来跨平台的良好移植性。交互式环境可以将Haskell编译成二进制代码，并且支持二进制代码与Haskell代码的混合执行。
+ 支持大量的库，这些库可以从 Hackage 得到。[5]

目前（2020.5.1），最新的GHC版本是2020.3.24发布的GHC8.10.1。

另一个使用比较多的Haskell实现是hugs。它遵循的是Haskell 98标准，只具有解释功能，不具有编译的功能，也没有丰富的库函数，所以很轻巧，适合入门使用。[6]

## chapter 4：计算机大师Dijkstra谈Haskell

因为Haskell实在太难理解，许多学生对将Haskell作为计算机入门课程表示了不满，因此德州大学决定将计算机入门课的Haskell改为Java。

2001年，出生于荷兰的计算机大师、 图灵奖获得者Edsger W. Dijkstra给德州大学预算委员会写信，力劝不要将计算机入门课程改为Java。

<img src="https://img.it610.com/image/info5/a44660b192184e738bc0068836b8df9b.jpg" width="180">  
Edsger W. Dijkstra

不幸的是，学校最终还是用Java课程替换了Haskell。相关联的，麻省理工的计算机程序结构和分析课程中的Scheme语言也被Python语言替换掉。

下面是这封信的翻译版，Dijkstra在里面浅谈了他认为学习Haskell的目的与意义，笔者认为这对于帮助我们深入理解Haskell很有好处。


**致预算委员会成员**

我写这封信给你们是因为有谣言说，大学教学中的计算机入门课程将不再使用函数式编程语言Haskell，而是使用命令式语言Java，鉴于此，我认为预算委员会有责任去阻止这项错误的决定。

你们知道，这不是小事。其它州的同行经常好奇于我如何能在德州奥斯汀这样的地方生存下来，他们都以为德州顽固的保守主义必然造就了同样顽固的平庸。我的回答通常是，“不要担心，教育系统还是一个比较开明的地方，例如在计算机入门课程上，我们教新生Haskell语言”；他们的反应起初通常都是怀疑，然后是嫉妒——大多是因为他们的大学课程无法再从Pascal语言向C++或Java这样的语言的转变中恢复回来。

我偏爱函数式编程的一个非常现实的原因是，对于新生的课程，大多数学生都已经对命令式编程有一定的熟悉。让他们面对新奇的函数式编程，能立即传达一个信息：编程比他们想象的要丰富的多。并且，他们很快就会观察到，对于他们用高中时学到的编程知识很难表达或无法表达的问题，函数式编程能提供优雅的解决方案。

而选择函数式编程的一个最根本的原因是，相比起命令式编程语言，它更容易当成数学对象来使用，在教学中你可以用它精确的解释程序是什么。另外一个优势是函数式编程的“延迟执行(lazy evaluation)”，它提供了一个环境来防止操作性的推理12。

最后，在Haskell语言跟Java的具体方面对比中，尽管Haskell不完美，但仍然比Java好几个数量级，Java就是一个大杂烩(它是通过大范围的广告和销售员夸张的宣传才达到它的商业接受)。总得来说，这事非常的糟糕，业界把有目共睹的低劣的设计当作了“事实”标准。我个人的认为，大学里应该让更健康的编程方式存在。

不仅仅是小提琴能塑造小提琴家，我们全都被我们使用的工具塑造，而在编程语言方面，影响是潜移默化的：它们塑造我们思考的习惯。这使得第一种编程语言的选择非常的重要。我们应该把入门课程当成一种工具来创造一种为计算机科学教学服务的文化，而不是去强迫丢掉过去的那些知识(如果非要这样，那我们的过去算是什么，成了永远的遗物)。这种选择担负着对我们的大学生的沉重责任，这也就是为什么这种事不能让某个什么主席来决定，而是应该由预算委员会来决定。这种事情不能让什么公务员或政客办理，这里需要有远见的政治家[3]。

**Austin, 12 April 2001**

**Edsger W. Dijkstra**




## Reference

[1]A History of Haskell: Being Lazy With Class. April 16, 2007. Paul Hudak.  

[2]https://spin.atomicobject.com/2013/03/05/why-haskell/  

[3]https://chrisdone.com/posts/dijkstra-haskell-java/  

[4]https://blog.csdn.net/comeonmyideal/article/details/6689574  

[5]https://www.haskell.org/ghc/  

[6]https://yq.aliyun.com/articles/91036  
 
[7]https://en.wikipedia.org/wiki/Haskell_(programming_language)#History  

[8]https://zh.wikipedia.org/wiki/Haskell#%E5%8E%86%E5%8F%B2  
